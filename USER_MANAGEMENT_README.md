# نظام إدارة المستخدمين

## نظرة عامة

تم إنشاء نظام إدارة مستخدمين كامل مع إدارة الأدوار باستخدام Laravel Permission. النظام يتيح للمديرين إدارة المستخدمين والأدوار والصلاحيات.

## الميزات

### 1. إدارة المستخدمين
- **عرض قائمة المستخدمين**: عرض جميع المستخدمين مع أدوارهم وتواريخ إنشائهم
- **إضافة مستخدم جديد**: إنشاء مستخدم جديد مع تعيين الأدوار وكلمة المرور
- **تعديل المستخدم**: تحديث بيانات المستخدم وأدواره وكلمة المرور
- **حذف المستخدم**: حذف المستخدم مع التأكيد
- **إعادة تعيين كلمة المرور**: إعادة تعيين كلمة المرور للمستخدم

### 2. إدارة الأدوار
- **دور المدير (admin)**: صلاحيات كاملة على النظام
- **دور الكاشير (cashier)**: صلاحيات محدودة للكاشير فقط

### 3. الصلاحيات
- `view sales reports`: عرض تقارير المبيعات
- `manage products`: إدارة المنتجات
- `use cashier`: استخدام الكاشير
- `manage users`: إدارة المستخدمين

## الملفات المضافة/المحدثة

### Controllers
- `app/Http/Controllers/Admin/UserController.php` - Controller إدارة المستخدمين

### Middleware
- `app/Http/Middleware/AdminMiddleware.php` - middleware للتحقق من دور المدير

### Vue Pages
- `resources/js/Pages/Admin/Users/Index.vue` - صفحة قائمة المستخدمين
- `resources/js/Pages/Admin/Users/Create.vue` - صفحة إضافة مستخدم جديد
- `resources/js/Pages/Admin/Users/Edit.vue` - صفحة تعديل المستخدم

### Routes
- تم إضافة روابط إدارة المستخدمين في `routes/web.php`
- تم إضافة middleware admin للحماية

### Layout
- تم تحديث `resources/js/Layouts/AppLayout.vue` لإضافة رابط إدارة المستخدمين
- تم إضافة شرط لإظهار الرابط للمديرين فقط

### Database
- `database/seeders/RoleSeeder.php` - تم تحديثه لإضافة صلاحية إدارة المستخدمين
- `app/Console/Commands/AssignAdminRole.php` - أمر لتعيين دور admin للمستخدمين

## كيفية الاستخدام

### 1. الوصول لنظام إدارة المستخدمين
- تسجيل الدخول بحساب مدير
- النقر على "إدارة المستخدمين" في القائمة الجانبية

### 2. إضافة مستخدم جديد
- النقر على "إضافة مستخدم جديد"
- ملء البيانات المطلوبة (الاسم، البريد الإلكتروني، كلمة المرور)
- اختيار الأدوار المطلوبة
- النقر على "إنشاء المستخدم"

### 3. تعديل مستخدم
- النقر على "تعديل" بجانب المستخدم المطلوب
- تحديث البيانات المطلوبة
- كلمة المرور اختيارية (اتركها فارغة إذا لم ترد تغييرها)
- النقر على "تحديث المستخدم"

### 4. حذف مستخدم
- النقر على "حذف" بجانب المستخدم المطلوب
- تأكيد الحذف في النافذة المنبثقة

### 5. إعادة تعيين كلمة المرور
- النقر على "إعادة تعيين كلمة المرور" بجانب المستخدم
- إدخال كلمة المرور الجديدة وتأكيدها
- النقر على "إعادة تعيين"

## الأمان

### Middleware Protection
- جميع روابط إدارة المستخدمين محمية بـ middleware `admin`
- يتم التحقق من دور المستخدم قبل السماح بالوصول

### Tenant Isolation
- المستخدمون محميون بنظام tenant_id
- المدير يمكنه فقط إدارة المستخدمين في نفس الـ tenant

### Validation
- تحقق شامل من البيانات المدخلة
- منع حذف المستخدم الحالي
- تحقق من صحة البريد الإلكتروني وكلمة المرور

## الأوامر المتاحة

### تشغيل Seeder
```bash
php artisan db:seed --class=RoleSeeder
```

### تعيين دور admin للمستخدمين
```bash
php artisan users:assign-admin-role
```

## ملاحظات مهمة

1. **الأدوار**: النظام يدعم دورين أساسيين (admin, cashier)
2. **الصلاحيات**: يمكن إضافة صلاحيات جديدة حسب الحاجة
3. **الأمان**: جميع العمليات محمية ومتحقق منها
4. **التوافق**: النظام متوافق مع نظام tenant الحالي
5. **الواجهة**: واجهة عربية كاملة مع تصميم متجاوب

## التطوير المستقبلي

- إضافة صلاحيات أكثر تفصيلاً
- إضافة سجل العمليات (audit log)
- إضافة إشعارات للمستخدمين
- إضافة تصدير/استيراد المستخدمين
- إضافة إدارة المجموعات 